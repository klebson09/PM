<!-- Right side column. Contains the navbar and content of the page -->
<div class="content-wrapper">

  <!-- Modal -->
  <div id="myModal" class="modal modal-success fade-in" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Sucesso!</h5>
                </div>
                <div class="modal-body">
                    <p id="msgPropAprov"><small></small></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline pull-right" data-dismiss="modal" onclick="redirecionarTimeline()">Fechar</button>
                </div>
            </div>
        </div>
    </div> 
  <!-- FIM Modal -->


  <!-- Content Header (Page header) -->
  <section class="content-header">
    <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
      <li class="active">Protótipos</li>
    </ol>
  </section>

            <!-- Main content -->
  <section class="content">
    <!-- Info boxes -->
    <div class="row">
      <div class="col-md-12">
        <div class="box">
          <div class="box-header with-border">
            <h3 class="box-title">Propostas recebida</h3>
            <!--  JSON.stringify(data); %> -->
          </div><!-- /.box-header -->
          <div class="box-body">
            <div class="row">
             <!-- /.col -->
             <div class="col-md-12">
               <div class="box box-primary">
                 <div class="box-header">
                   <h3 class="box-title"></h3>


                 </div>
                 <!-- /.box-header -->
                 <div class="box-body no-padding">
                   <table class="table">
                     <tbody><tr>
                       <th>Nome da Equipe</th>
                       <th>Apresentação</th>
                       <th>Dúvidas</th>
                       <th>Resposta</th>
                       <th>Aprovar/Recusar</th>
                       <!-- <th style="width: 40px">Função</th> -->
                     </tr>
                     <% for(var i=0; i < data.length; i++){
                          for(var x=0; x < data[i].propostas.length; x++){
                     %>
                     <% var proposta = data[i].propostas[x] %>
                     <tr>
                       <td><%=proposta.nomeEquipe %></td>
                       <td><%=proposta.apresentacao %></td>
                       <td><%=proposta.duvidas %></td>
                       <td><span><%= proposta.feedback %></span></td>
                       <td>
                         <button type="button" class="btn btn-default btn-sm" data-toggle="modal" value="<%=proposta.idProposta;%>" onclick="btnIdProposta(this.value)" data-target="#myModal">Responder</button>
                         <button type="button" class="btn btn-success btn-sm" value="" onclick="btnAprovar(<%=proposta.idProposta%>,<%=proposta.idProjeto%>,<%=proposta.idEquipe%>)" >Aprovar</button>
                         <button type="button" class="btn btn-danger btn-sm"  value="" onclick="btnRecusar(<%=proposta.idProposta%>,<%=proposta.idProjeto%>,<%=proposta.idEquipe%>, '<%=proposta.nomeEquipe%>', '<%=nomeProj%>')" >Recusar</button>
                       </td>
                       <!-- <td><span class="badge bg-red">Tutor</span></td> -->
                     </tr>
                     <% }
                      }
                     %>
                   </tbody></table>
                 </div>
                 <!-- /.box-body -->
               </div>

             </div>
 <!-- /.col -->
</div>
          </div><!-- ./box-body -->

        </div><!-- /.box -->
      </div><!-- /.col -->
    </div><!-- /.row -->
    <a id="propAprov" href="#" data-toggle="modal" data-target="#myModal"></a> 
  </section><!-- /.content -->
</div><!-- /.content-wrapper -->
<!-- <script src="plugins/jQuery/jQuery-2.1.3.min.js"></script> -->

<script>
  var selecionado = null;
  function btnIdProposta(value) {
    //  alert(value);
    console.log("O/ btnIdProposta "+value);
      document.getElementById("idProposta").setAttribute('value',value);
  }
  function btnRecusar(e,f,g,h,i) {
    console.log("O/ btnRecusar ");
    $.post( "/aprovar_proposta", { idProposta: e, status: "Recusado", idProjeto: f, idEquipe: g, nomeEquipe: h, nomeProjeto: i},
    function(data){

       console.log("resultado = "+data.resultado);

       alert(data.mensagem);

       window.location.replace("/homeTimeLine");

      } );
  }
  function btnAprovar(e,f,g) {
    //  alert(value);
      // document.getElementById("idProposta").setAttribute('value',value);
      console.log("O/ btnAprovar "+e);
      // console.log("O/ btnAprovar "+evtId.target.id);
      $.post( "/aprovar_proposta", { idProposta: e, status: "Aprovada", idProjeto: f, idEquipe: g }, function(data){

        console.log("resultado = "+data.resultado);

        document.getElementById("msgPropAprov").innerHTML = data.mensagem;

        document.getElementById("propAprov").click();

      } );


      
  }

  function redirecionarTimeline(){
        window.location.replace("/homeTimeLine");
      }
</script>
