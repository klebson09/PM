<html>
  <head>
    <meta charset="UTF-8">
    <title>Dados Cadastrais do Cliente</title>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
    <!-- Bootstrap 3.3.2 -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Font Awesome Icons -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <!-- Theme style -->
    <link href="dist/css/AdminLTE.min.css" rel="stylesheet" type="text/css" />
    <!-- iCheck -->
    <link href="plugins/iCheck/square/blue.css" rel="stylesheet" type="text/css" />
    <link href="dist/css/skins/_all-skins.min.css" rel="stylesheet" type="text/css" />
    <link href="tabulator-master/dist/css/tabulator.min.css" rel="stylesheet">
    <link href="tabulator-master/dist/css/bootstrap/tabulator_bootstrap4.min.css" rel="stylesheet">
    <link href="tabulator-master/dist/css/semantic-ui/tabulator_semantic-ui.min.css" rel="stylesheet">
  </head>
  <body class="skin-green" id="contentForm">


    <!-- Site wrapper -->
    <div class="wrapper">


      <!-- Right side column. Contains the navbar and content of the page -->
      <div class="content-wrapper">

        <!-- Main content -->
        <section class="content">

         <div id="alterarDadosModal" class="modal modal-warning fade-in" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Atenção</h5>
                    </div>
                    <div class="modal-body">
                        <p><small>Confirmar alteração dos dados?</small></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline pull-left " data-dismiss="modal" onclick="submeterForm()">Sim</button>
                        <button type="button" class="btn btn-outline pull-right" data-dismiss="modal">Não</button>
                    </div>
                </div>
            </div>
        </div>

         <div id="erroModal" class="modal modal-danger fade-in" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Atenção</h5>
                    </div>
                    <div class="modal-body" id="msgsErro">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline pull-right" data-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>  

          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <div class="box box-success">

                <form id="formAlterarDados" action="/alterar_dados_cliente" method="post" >
                  <!-- fieldsets -->
                  <fieldset>
                    <!-- <div class="box box-success"> -->
                    <h2 class="fs-title col-md-offset-1" id="tituloForm" style="padding-bottom: 20px;">  Dados Cadastrais do Cliente</h2>
                    <!-- <h3 class="fs-subtitle">This is step 1</h3> -->

                    <div class="form-group  col-md-12 ">
                      <label for="nomeUsuario">Nome</label>
                      <input type="text" id="nomeUsuario" name="nomeUsuario" class="form-control"  value="<%= dadosUsuario.nomeUsuario %>" required />
                    </div>

                    <div class="form-group  col-md-12 ">
                      <div  class="radio-inline ">
                        <label>
                          <input type="radio" name="tipoPessoa" id="pessoaFisica" class="" value="F"  onchange="handleRadioTipoPessoa(this, true)" checked >Pessoa Física
                        </label>
                      </div>
                      <div  class="radio-inline">
                        <label>
                          <input type="radio" name="tipoPessoa" id="pessoaJuridica" class="minimal-red" onchange="handleRadioTipoPessoa(this, true)" value="J">Pessoa Jurídica
                        </label>
                      </div>
                      </div>


                    <div class="form-group  col-md-12 " id="grupoCPF">
                      <label for="cpf">CPF</label>
                      <input type="text" id="cpf" name="cpf" class="form-control" value="<%= dadosUsuario.cpf_cnpj %>" required />
                    </div>

                    <div class="form-group  col-md-12 " id="grupoCNPJ" style="display: none;">
                      <label for="cnpj">CNPJ</label>
                      <input type="text" id="cnpj" name="cnpj" class="form-control" value="<%= dadosUsuario.cpf_cnpj %>" required />
                    </div>

                    <div class="form-group col-md-12">
                    <label for="telefone">Telefone</label>
                    <input type="text" id="telefone" name="telefone" class="form-control" value="<%= dadosUsuario.telefone %>"  />
                    </div>
                    <div class="form-group col-md-12">
                      <label for="celular">Celular</label>
                      <input type="text" id="celular" name="celular" class="form-control" value="<%= dadosUsuario.celular %>"  />
                    </div>
                    <div class="form-group col-md-12">
                      <label for="email">E-mail</label>
                      <input type="email" id="email" name="email" class="form-control" value="<%= dadosUsuario.email %>" required />
                    </div>
              

                    <input type="hidden" name="idContato" value="<%= dadosUsuario.idContato %>" />
           

              
                    <div class="form-group col-md-12">
                      <input type="button" id="btnAlterarDados"  class="submit action-button btn  btn-success col-md-offset-5" value="Enviar" onclick="alertAlterarDados()" />
                    </div>
                  </div>

                </div>


              </fieldset>

            </form>

            <input type="hidden" name="tipoPessoa" id="hiddenTipoPessoa" value="<%= dadosUsuario.tipoPessoa %>" />    
 

             <a id="askAlterarDados" href="#" data-toggle="modal" data-target="#alterarDadosModal"></a> 
             <a id="erroModalLink" href="#" data-toggle="modal" data-target="#erroModal"></a> 

          </div>
        </div>




      </div>
      <!-- jQuery -->
      <!--<script src="http://thecodeplayer.com/uploads/js/jquery-1.9.1.min.js" type="text/javascript"></script>-->
      <!-- jQuery easing plugin -->
      <!--<script src="http://thecodeplayer.com/uploads/js/jquery.easing.min.js" type="text/javascript"></script>-->
      <script src="js/script_multiform.js" type="text/javascript"></script>

    </section><!-- /.content -->
  </div><!-- /.content-wrapper -->

   <!-- <script src="plugins/jQuery/jQuery-2.1.3.min.js"></script>-->
    <!--<script type="text/javascript" src="jquery-ui-1.12.1/jquery-ui.min.js"></script>-->
    <!-- Bootstrap 3.3.2 JS -->
    <script src="bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <!-- FastClick -->
    <script src='plugins/fastclick/fastclick.min.js'></script>
    <!-- AdminLTE App -->
    <script src="dist/js/app.min.js" type="text/javascript"></script>
    <!-- Sparkline -->
    <script src="plugins/sparkline/jquery.sparkline.min.js" type="text/javascript"></script>
    <!-- jvectormap -->
    <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js" type="text/javascript"></script>
    <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js" type="text/javascript"></script>
    <!-- daterangepicker -->
    <script src="plugins/daterangepicker/daterangepicker.js" type="text/javascript"></script>
    <!-- datepicker -->
    <script src="plugins/datepicker/bootstrap-datepicker.js" type="text/javascript"></script>
    <!-- iCheck -->
    <script src="plugins/iCheck/icheck.min.js" type="text/javascript"></script>
    <!-- SlimScroll 1.3.0 -->
    <script src="plugins/slimScroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <!-- ChartJS 1.0.1 -->
    <script src="plugins/chartjs/Chart.min.js" type="text/javascript"></script>

    <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
    <script src="dist/js/pages/dashboard2.js" type="text/javascript"></script>

    <!-- AdminLTE for demo purposes -->
    <script src="dist/js/demo.js" type="text/javascript"></script>

    <script src="js/script_multiform.js" type="text/javascript"></script>

    <script type="text/javascript" src="tabulator-master/dist/js/tabulator.min.js"></script>

    <script type="text/javascript" src="moment/moment.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.0/jquery.mask.js"></script>

    <script src="js/valida_cpf_cnpj.js" type="text/javascript"></script>

    <script>

      var mensagensErro = document.getElementById("msgsErro");

      function submeterForm(){
        if(validarCampos()){
            document.getElementById("formAlterarDados").submit();
        } else {
            document.getElementById("erroModalLink").click();
        }

      }

      function validarCampos(){
        var cpfCnpjValido = validarCPFCNPJ();
        var emailValido = validarEmail();
        return cpfCnpjValido && emailValido;      
      }

      function adicionarMensagemErro(msg){

         var p = document.createElement("p");
         var small = document.createElement("small");
         var msgErro = document.createTextNode(msg);
         small.append(msgErro);
         p.append(small);

         return p;
      }


      function validarCPFCNPJ(){

        var tipoPessoa = document.getElementById("hiddenTipoPessoa");
        var cpf_cnpj = "";
        var ehValido = false;

        if(tipoPessoa.value == 'F'){
            cpf_cnpj = document.getElementById("cpf").value;
            ehValido = valida_cpf(cpf_cnpj);
        } else {
            cpf_cnpj = document.getElementById("cnpj").value;
            ehValido = valida_cnpj(cpf_cnpj);
        }

        if(!ehValido){
          mensagensErro.append(adicionarMensagemErro("CPF/CNPJ Inválido"));
        }

        return ehValido;
      }

      function validarEmail(){
        var field = document.getElementById("email");
        var usuario = field.value.substring(0, field.value.indexOf("@"));
        var dominio = field.value.substring(field.value.indexOf("@")+ 1, field.value.length);

        if(usuario != '' && dominio != ''){

          if ((usuario.length >=1) &&
          (dominio.length >=3) &&
          (usuario.search("@")==-1) &&
          (dominio.search("@")==-1) &&
          (usuario.search(" ")==-1) &&
          (dominio.search(" ")==-1) &&
          (dominio.search(".")!=-1) &&
          (dominio.indexOf(".") >=1) &&
          (dominio.lastIndexOf(".") < dominio.length - 1)) {
            return true;
          }
          else{
            mensagensErro.append(adicionarMensagemErro("E-mail Inválido"));
            return false;
          }
        } else{
          mensagensErro.append(adicionarMensagemErro("E-mail Inválido"));
          return false;
        }
      }

      function alertAlterarDados(){
        limparMensagensErro();
        document.getElementById('askAlterarDados').click();
      }

      function limparMensagensErro(){
          while (mensagensErro.firstChild) {
            mensagensErro.removeChild(mensagensErro.firstChild);
          }
      }

      function verificarCampoRadioTipoPessoa(){
        var tipoPessoa = document.getElementById("hiddenTipoPessoa");
        var pessoaJuridica = document.getElementById("pessoaJuridica");
        var pessoaFisica = document.getElementById("pessoaFisica");

        if(tipoPessoa.value == pessoaJuridica.value){
          pessoaJuridica.checked = true;
          pessoaFisica.checked = false;

          handleRadioTipoPessoa(pessoaJuridica, false);
        } else {
          pessoaFisica.checked = true;
          pessoaJuridica.checked = false;

          handleRadioTipoPessoa(pessoaFisica, false);
        }
       

      }

      function handleRadioTipoPessoa(radio, flag){
        var tipoPessoa = radio.value;
        console.log(radio.value);
        if(tipoPessoa == 'F'){
          var $cpf = $("#cpf");
          if(flag){
              $cpf.val('');
          }
          $cpf.mask('000.000.000-00', {reverse: false});
          document.getElementById("grupoCPF").style.display = "block";
          document.getElementById("grupoCNPJ").style.display = "none";
          document.getElementById("hiddenTipoPessoa").value = 'F';
        } else if(tipoPessoa == 'J'){
          var $cnpj = $("#cnpj");
          if(flag){
            $cnpj.val('');
          }
          $cnpj.mask('00.000.000/0000-00', {reverse: false});
          document.getElementById("grupoCPF").style.display = "none";
          document.getElementById("grupoCNPJ").style.display = "block";
          document.getElementById("hiddenTipoPessoa").value = 'J';
        }
      }

      //Máscaras dos campos
          $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();
            var $cpf = $("#cpf");
            $cpf.mask('000.000.000-00', {reverse: false});

            var $cnpj = $("#cpnj");
            $cnpj.val('');
            $cnpj.mask('00.000.000/0000-00', {reverse: false});

            var $telefone = $("#telefone");
            $telefone.mask('(00)0000-0000', {reverse: false});

            var $celular = $("#celular");
            $celular.mask('(00)00000-0000', {reverse: false});

            verificarCampoRadioTipoPessoa();

          });


    </script>
  </body>
</html>
